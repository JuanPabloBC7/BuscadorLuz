---------------------------------------------
PIC ASSEMBLER LISTING
Line    Address Opcode  Instruction
---------------------------------------------
0001    0000            ;;; 160 PASOS EN X
0002    0000            DATO	EQU 0X21
0003    0000            d1   	EQU 0X22
0004    0000            d2	EQU 0X23
0005    0000            d3	EQU 0X24
0006    0000            d4	EQU 0x25
0007    0000            d5	EQU 0X26
0008    0000            d6	EQU 0X27
0009    0000            d7	EQU 0X28
0010    0000            d8	EQU 0x29
0011    0000            d9	EQU 0X2A
0012    0000            x	EQU 0x2B
0013    0000            y	EQU 0x2C
0014    0000            x_f	EQU 0x2D
0015    0000            y_f	EQU 0X2E
0016    0000            cond_x	EQU 0x30
0017    0000            cond_y	EQU 0x31
0018    0000            d10	EQU 0x32
0019    0000            d11	EQU 0x33
0020    0000            luzAct	EQU 0x34
0021    0000            inciso	EQU 0x35
0022    0000            
0023    0000            dato1	EQU 0x36
0024    0000            dato2	EQU 0x37
0025    0000            dato3	EQU 0X38
0026    0000            dato4	EQU 0x39
0027    0000            
0028    0000            categoria	EQU	0x3A
0029    0000            luz512		EQU	0x3B
0030    0000            
0031    0000            var2show EQU 0x3C
0032    0000            
0033    0000            ;; Variables FotoResistencia
0034    0000            ADC	EQU	0x3D
0035    0000            CON	EQU	0X3F
0036    0000            CON2	EQU	0X40
0037    0000            CON3	EQU	0X41
0038    0000            
0039    0000            luzmax	EQU	0x42
0040    0000            luzmin	EQU	0X43
0041    0000            
0042    0000            ndispositivo EQU 0x44
0043    0000            ;; variables 
0044    0000            
0045    0000            INICIO
0046    0000            	ORG	0X00
0047    0000            
0048    0000    1283    	bcf STATUS,RP0 ;Ir banco 0
0049    0001    1303    	bcf STATUS,RP1
0050    0002    3041    	movlw b'01000001' ;A/D conversion Fosc/8
0051    0003    009F    	movwf ADCON0
0052    0004            	;     	     7     6     5    4    3    2       1 0
0053    0004            	; 1Fh ADCON0 ADCS1 ADCS0 CHS2 CHS1 CHS0 GO/DONE ? ADON
0054    0004    1683    	bsf STATUS,RP0 ;Ir banco 1
0055    0005    1303    	bcf STATUS,RP1
0056    0006    3007    	movlw b'00000111'
0057    0007    0081    	movwf OPTION_REG ;TMR0 preescaler, 1:156
0058    0008            
0059    0008            	;                7    6      5    4    3   2   1   0 
0060    0008            	; 81h OPTION_REG RBPU INTEDG T0CS T0SE PSA PS2 PS1 PS0
0061    0008    300E    	movlw b'00001110' ;A/D Port AN0/RA0
0062    0009    009F    	movwf ADCON1
0063    000A            	;            7    6     5 4 3     2     1     0 
0064    000A            	; 9Fh ADCON1 ADFM ADCS2 ? ? PCFG3 PCFG2 PCFG1 PCFG0
0065    000A    1405    	bsf TRISA,0 ;RA0 linea de entrada para el ADC
0066    000B            	;clrf TRISB
0067    000B    1283    	bcf STATUS,RP0 ;Ir banco 0
0068    000C    1303    	bcf STATUS,RP1
0069    000D            
0070    000D            
0071    000D            
0072    000D            
0073    000D    1683    	BSF	STATUS, 5 ; Colocamos en 1 el bit 5 de reg. estatus 
0074    000E            ; en el banco 1 tenemos trisa, trisb, ... , trisd
0075    000E            ; debemos configurar puerto de entrada y salida..
0076    000E            ; puerto b
0077    000E    0186    	CLRF	TRISB		; CLEAR FILE CONFIGURA EL PUERTO B PARA QUE SEA SALIDA (0 = SALIDA)
0078    000F            	;BSF TRISA, 7		; PUERTO A -> ENTRADA
0079    000F    0187    	CLRF 	TRISC		; PUERTO C -> SALIDA
0080    0010    1788    	BSF TRISD, 7
0081    0011            	
0082    0011    1283    	BCF	STATUS, RP0		;BITCLEAR FILE DE RP0 = BIT CLEARFY 5
0083    0012            	
0084    0012    3000    	movlw 0x00;
0085    0013    0086    	movwf	portb;
0086    0014    3000    	movlw 0x00;
0087    0015    0088    	movwf portd;
0088    0016            
0089    0016            
0090    0016            
0091    0016            START
0092    0016            	; Declaramos variables
0093    0016    300E    	movlw	d'14'
0094    0017    00AD    	movwf	x_f
0095    0018    3032    	movlw	d'50'
0096    0019    00AE    	movwf	y_f	
0097    001A            
0098    001A    3003    	movlw	d'3'
0099    001B    00B4    	movwf	luzact
0100    001C            	
0101    001C    3000    	movlw   d'0'
0102    001D    00AB    	movwf	x
0103    001E    3000    	movlw	d'0'
0104    001F    00AC    	movwf	y
0105    0020            	
0106    0020    3001    	movlw	d'1'
0107    0021    00B5    	movwf	inciso
0108    0022            
0109    0022            	; primer inciso
0110    0022    3001    	movlw	d'1'
0111    0023    00B6    	movwf	dato1
0112    0024            
0113    0024    3002    	movlw	d'2'
0114    0025    00B7    	movwf	dato2
0115    0026            
0116    0026    3003    	movlw	d'3'
0117    0027    00B8    	movwf	dato3
0118    0028            
0119    0028    3004    	movlw	d'4'
0120    0029    00B9    	movwf	dato4
0121    002A            	
0122    002A    3000    	MOVLW	d'0'
0123    002B    00C2    	movwf	luzmax
0124    002C            
0125    002C    3013    	movlw	d'19'
0126    002D    00C3    	movwf	luzmin
0127    002E            
0128    002E            		
0129    002E    3008    	movlw d'8'
0130    002F    00C4    	movwf	ndispositivo
0131    0030            
0132    0030    20EB    	CALL MovimientoDelanteCompleto
0133    0031            	
0134    0031            	
0135    0031    2069    	CALL Buscar_X
0136    0032    2073    	CALL Buscar_Y
0137    0033            	
0138    0033            infinite
0139    0033    2035    	CALL MENUBTN
0140    0034    2833    	goto infinite
0141    0035            
0142    0035            END
0143    0035            MENUBTN
0144    0035    2102    	CALL delay
0145    0036    2102    	CALL delay
0146    0037    2102    	CALL delay
0147    0038    2102    	CALL delay
0148    0039    2102    	CALL delay
0149    003A    2102    	CALL delay
0150    003B    2102    	CALL delay
0151    003C    2102    	CALL delay
0152    003D    2102    	CALL delay
0153    003E    2102    	CALL delay
0154    003F    2102    	CALL delay
0155    0040    2102    	CALL delay
0156    0041    1C88    	BTFSS PORTD, 1	; VERIFICA SI BOTÓN ESTÁ PRESIONADO
0157    0042    2835    	GOTO MENUBTN		; SI NO ESTÁ PRESIONADO
0158    0043            	
0159    0043    1835    	BTFSC inciso, 0 ; SALTA SI EL PRIMER BIT ESTÁ APAGADO
0160    0044    284C    	GOTO inciso1	; PRIMER BIT ENCENDIDO
0161    0045    18B5    	BTFSC inciso, 1	; SALTA SI EL SEGUNDO BIT ESTÁ APAGADO
0162    0046    2854    	GOTO inciso2	; SEGUNDO BIT ENCENDIDO
0163    0047    1935    	BTFSC inciso, 2	; SALTA SI EL TERCER BIT ESTÁ APAGADO
0164    0048    285A    	GOTO inciso3	; TERCER BIT ENCENDIDO
0165    0049    19B5    	BTFSC inciso, 3	; SALTA SI EL CUARTO BIT ESTÁ APAGADO
0166    004A    2860    	GOTO inciso4	; CUARTO BIT ENCENDIDO
0167    004B            		
0168    004B    0008    	RETURN
0169    004C            
0170    004C            
0171    004C            	
0172    004C            
0173    004C            	
0174    004C            	
0175    004C            	
0176    004C            
0177    004C            inciso1
0178    004C            	
0179    004C    3002    	movlw	b'10'
0180    004D    00B5    	movwf	inciso
0181    004E            	
0182    004E    217D    	CALL AsignarLuz512
0183    004F    214D    	CALL getCategoria
0184    0050    083A    	movf categoria, w
0185    0051    00BC    	movwf	var2show
0186    0052    210D    	call mostrardisplay	
0187    0053    0008    	RETURN		; SI NO ESTÁ PRESIONADO
0188    0054            inciso2
0189    0054            
0190    0054    3004    	movlw	b'100'
0191    0055    00B5    	movwf	inciso
0192    0056    0842    	movf luzmax, w
0193    0057    00BC    	movwf var2show
0194    0058    210D    	CALL MOSTRARDISPLAY
0195    0059    0008    	RETURN
0196    005A            inciso3
0197    005A            	
0198    005A    3008    	movlw	b'1000'
0199    005B    00B5    	movwf	inciso
0200    005C    0843    	movf luzmin, w
0201    005D    00BC    	movwf var2show
0202    005E    210D    	CALL MOSTRARDISPLAY
0203    005F    0008    	RETURN
0204    0060            inciso4
0205    0060            	
0206    0060    3001    	movlw b'1'
0207    0061    00B5    	movwf	inciso
0208    0062    0844    	movf ndispositivo, w
0209    0063    00BC    	movwf var2show
0210    0064    210D    	CALL MOSTRARDISPLAY
0211    0065    0008    	RETURN
0212    0066            
0213    0066            
0214    0066            REC_FINAL
0215    0066    2069    	CALL Buscar_X
0216    0067    2073    	CALL Buscar_Y
0217    0068    0008    	RETURN
0218    0069            	
0219    0069            ;;;;;
0220    0069            BUSCAR_X
0221    0069    20E3    	CALL MOVIMIENTOADELANTE
0222    006A    0AAB    	INCF x, 1
0223    006B    082D    	movf x_f, W
0224    006C    00B3    	movwf d11
0225    006D            INICIOBUSCAx
0226    006D    0BB3    	decfsz d11, 1
0227    006E    2870    	GOTO b13
0228    006F    0008    	RETURN
0229    0070            B13
0230    0070    20E3    	CALL MOVIMIENTOADELANTE		; 10 PASOADELANTE
0231    0071    0AAB    	INCF x, 1	
0232    0072    286D    	GOTO INICIOBUSCAx
0233    0073            ;;;;
0234    0073            ;;;;;
0235    0073            BUSCAR_Y
0236    0073    2091    	CALL PASOBDELANTE
0237    0074    2091    	CALL PASOBDELANTE
0238    0075    0AAC    	INCF Y, 1
0239    0076    082E    	movf y_f, W
0240    0077    00B2    	movwf d10
0241    0078            INICIOBUSCAy
0242    0078    0BB2    	decfsz d10, 1
0243    0079    287B    	GOTO B14
0244    007A    0008    	RETURN
0245    007B            B14
0246    007B    2091    	CALL PASOBDELANTE
0247    007C    2091    	CALL PASOBDELANTE
0248    007D    0AAC    	INCF Y, 1
0249    007E    2878    	GOTO INICIOBUSCAy
0250    007F            ;;;;
0251    007F            
0252    007F            
0253    007F            
0254    007F            PASOADELANTE
0255    007F    20A1    	CALL PASO1A
0256    0080    2102    	CALL DELAY
0257    0081    20A5    	CALL PASO2A
0258    0082    2102    	CALL DELAY
0259    0083    20A9    	CALL PASO3A
0260    0084    2102    	CALL DELAY
0261    0085    20AD    	CALL PASO4A
0262    0086    2102    	CALL DELAY
0263    0087    0008    	RETURN	
0264    0088            PASOAREVEZ
0265    0088    20AD    	CALL PASO4A
0266    0089    2102    	CALL DELAY
0267    008A    20A9    	CALL PASO3A
0268    008B    2102    	CALL DELAY
0269    008C    20A5    	CALL PASO2A
0270    008D    2102    	CALL DELAY
0271    008E    20A1    	CALL PASO1A
0272    008F    2102    	CALL DELAY
0273    0090    0008    	RETURN	
0274    0091            
0275    0091            PASOBDELANTE
0276    0091    20B1    	CALL PASO1B
0277    0092    2102    	CALL DELAY
0278    0093    20B5    	CALL PASO2B
0279    0094    2102    	CALL DELAY
0280    0095    20B9    	CALL PASO3B
0281    0096    2102    	CALL DELAY
0282    0097    20BD    	CALL PASO4B
0283    0098    0008    	RETURN
0284    0099            
0285    0099            PASOBREVEZ
0286    0099    20BD    	CALL PASO4B
0287    009A    2102    	CALL DELAY
0288    009B    20B9    	CALL PASO3B
0289    009C    2102    	CALL DELAY
0290    009D    20B5    	CALL PASO2B
0291    009E    2102    	CALL DELAY
0292    009F    20B1    	CALL PASO1B
0293    00A0    0008    	RETURN
0294    00A1            
0295    00A1            	
0296    00A1            PASO1A
0297    00A1    300C    	MOVLW	B'00001100' 	; EN W SE ENCUENTRA 0001100
0298    00A2    00A1    	MOVWF	DATO		; DE W A F LE MOVEMOS F
0299    00A3    20C1    	CALL DISPLAYA
0300    00A4    0008    	RETURN
0301    00A5            PASO2A
0302    00A5    3006    	MOVLW	B'00000110' ; EN W SE ENCUENTRA 0001100
0303    00A6    00A1    	MOVWF	DATO		; DE W A F LE MOVEMOS F
0304    00A7    20C1    	CALL DISPLAYA
0305    00A8    0008    	RETURN
0306    00A9            PASO3A
0307    00A9    3003    	MOVLW	B'00000011' ; EN W SE ENCUENTRA 0001100
0308    00AA    00A1    	MOVWF	DATO		; DE W A F LE MOVEMOS F
0309    00AB    20C1    	CALL DISPLAYA
0310    00AC    0008    	RETURN
0311    00AD            PASO4A
0312    00AD    3009    	MOVLW	B'00001001' ; EN W SE ENCUENTRA 0001100
0313    00AE    00A1    	MOVWF	DATO		; DE W A F LE MOVEMOS F
0314    00AF    20C1    	CALL DISPLAYA
0315    00B0    0008    	RETURN
0316    00B1            
0317    00B1            PASO1B
0318    00B1    300C    	MOVLW	B'00001100' ; EN W SE ENCUENTRA 0001100
0319    00B2    00A1     	MOVWF	DATO		; DE W A F LE MOVEMOS F
0320    00B3    20C4    	CALL DISPLAYB
0321    00B4    0008    	RETURN
0322    00B5            PASO2B
0323    00B5    3006    	MOVLW	B'00000110' ; EN W SE ENCUENTRA 0001100
0324    00B6    00A1    	MOVWF	DATO		; DE W A F LE MOVEMOS F
0325    00B7    20C4    	CALL DISPLAYB
0326    00B8    0008    	RETURN
0327    00B9            PASO3B
0328    00B9    3003    	MOVLW	B'00000011' ; EN W SE ENCUENTRA 0001100
0329    00BA    00A1    	MOVWF	DATO		; DE W A F LE MOVEMOS F
0330    00BB    20C4    	CALL DISPLAYB
0331    00BC    0008    	RETURN
0332    00BD            PASO4B
0333    00BD    3009    	MOVLW	B'00001001' ; EN W SE ENCUENTRA 0001100
0334    00BE    00A1    	MOVWF	DATO		; DE W A F LE MOVEMOS F
0335    00BF    20C4    	CALL DISPLAYB
0336    00C0    0008    	RETURN
0337    00C1            
0338    00C1            
0339    00C1            
0340    00C1            DISPLAYA
0341    00C1    0821    	MOVF	DATO, W
0342    00C2    0086    	MOVWF	PORTB	
0343    00C3    0008    	RETURN
0344    00C4            
0345    00C4            DISPLAYB
0346    00C4            	; Se limpia mitad de puertos inservibles
0347    00C4    1206    	BCF PORTB, 4
0348    00C5    1286    	BCF PORTB, 5
0349    00C6    1306    	BCF PORTB, 6
0350    00C7    1386    	BCF PORTB, 7
0351    00C8            
0352    00C8            	
0353    00C8            	; Shift para colocar en parte más significativa
0354    00C8    0DA1    	RLF DATO, 1
0355    00C9    0DA1    	RLF DATO, 1
0356    00CA    0DA1    	RLF DATO, 1
0357    00CB    0DA1    	RLF DATO, 1
0358    00CC            
0359    00CC    0821    	MOVF	DATO, W
0360    00CD    0486    	IORWF	PORTB, 1 ; OR ENTRE DATO Y PUERTOB
0361    00CE    0008    	RETURN
0362    00CF            
0363    00CF            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0364    00CF            MOVIMIENTOBDELANTE
0365    00CF    3050    	movlw d'80'			;160 (150)
0366    00D0    00A6    	movwf d5	
0367    00D1            INICIOMOVIMIENTOB1
0368    00D1    0BA6    	decfsz d5, 1
0369    00D2    28D4    	GOTO B1
0370    00D3    0008    	RETURN
0371    00D4            B1
0372    00D4    2091    	CALL PASOBDELANTE 	; 32 PASOS
0373    00D5    2091    	CALL PASOBDELANTE
0374    00D6    0AAC    	INCF y, 1
0375    00D7    21A1    	CALL ASSMAXMIN_P	
0376    00D8    28D1    	GOTO INICIOMOVIMIENTOB1
0377    00D9            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0378    00D9            MOVIMIENTOBDETRAZ
0379    00D9    3050    	movlw d'80'			; 160 (170)
0380    00DA    00A7    	movwf d6
0381    00DB            INICIOMOVIMIENTOB2
0382    00DB    0BA7    	decfsz d6, 1
0383    00DC    28DE    	GOTO B2
0384    00DD    0008    	RETURN
0385    00DE            B2
0386    00DE    2099    	CALL PASOBREVEZ	; 32 PASOS
0387    00DF    2099    	CALL PASOBREVEZ
0388    00E0    21A1    	CALL ASSMAXMIN_P	
0389    00E1    03AC    	DECF y, 1
0390    00E2    28DB    	GOTO INICIOMOVIMIENTOB2
0391    00E3            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0392    00E3            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0393    00E3            MOVIMIENTOADELANTE
0394    00E3    3011    	movlw d'17'
0395    00E4    00A8    	movwf d7
0396    00E5            INICIOMOVIMIENTOA1
0397    00E5    0BA8    	decfsz d7, 1
0398    00E6    28E8    	GOTO A1
0399    00E7    0008    	RETURN
0400    00E8            A1
0401    00E8    207F    	CALL PASOADELANTE	; 32 PASOS
0402    00E9    207F    	CALL PASOADELANTE
0403    00EA    28E5    	GOTO INICIOMOVIMIENTOA1
0404    00EB            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0405    00EB            MovimientoDelanteCompleto
0406    00EB    3009    	movlw d'9'			; 8 es el correc
0407    00EC    00A9    	movwf d8
0408    00ED            INICIOMOVIMIENTOC1
0409    00ED    0BA9    	decfsz d8, 1
0410    00EE    28F0    	GOTO C1
0411    00EF    0008    	RETURN
0412    00F0            C1
0413    00F0    20E3    	CALL MOVIMIENTOADELANTE		; 10 PASOADELANTE
0414    00F1    0AAB    	INCF x, 1
0415    00F2    21A1    	CALL ASSMAXMIN_P	
0416    00F3    20CF    	CALL MOVIMIENTOBDELANTE
0417    00F4    20E3    	CALL MOVIMIENTOADELANTE		; 10 PASOADELANTE
0418    00F5    0AAB    	INCF x, 1
0419    00F6    21A1    	CALL ASSMAXMIN_P	
0420    00F7    20D9    	CALL MOVIMIENTOBDETRAZ
0421    00F8    28ED    	GOTO INICIOMOVIMIENTOC1
0422    00F9            
0423    00F9            MovimientoDetrazCompleto
0424    00F9    30FF    	movlw d'255'			; 255 es el correcto
0425    00FA    00AA    	movwf d9
0426    00FB            INICIOMOVIMIENTOD1
0427    00FB    0BAA    	decfsz d9, 1
0428    00FC    2900    	GOTO MOVD1
0429    00FD    3000    	MOVLW	B'0' 	; EN W SE ENCUENTRA 0
0430    00FE    00AB    	MOVWF	x	; Movemos a x, w -> x = 0 (reseteamos x)
0431    00FF            
0432    00FF            
0433    00FF    0008    	RETURN
0434    0100            MOVD1
0435    0100    2088    	CALL PASOAREVEZ			
0436    0101    28FB    	GOTO INICIOMOVIMIENTOD1		
0437    0102            
0438    0102            
0439    0102            
0440    0102            
0441    0102            Delay
0442    0102            			;1693 cycles
0443    0102    3052    	movlw	0x52
0444    0103    00A2    	movwf	d1
0445    0104    3002    	movlw	0x02
0446    0105    00A3    	movwf	d2
0447    0106            Delay_0
0448    0106    0BA2    	decfsz	d1, f
0449    0107    2909    	goto	$+2
0450    0108    0BA3    	decfsz	d2, f
0451    0109    2906    	goto	Delay_0
0452    010A            
0453    010A            			;3 cycles
0454    010A    290B    	goto	$+1
0455    010B    0000    	nop
0456    010C            
0457    010C            			;4 cycles (including call)
0458    010C    0008    	return
0459    010D            ; Generated by http://w
0460    010D            
0461    010D            ;;;;;;; ;;;;MOSTRAR DISPLAY ;;;;;;;;;
0462    010D            MOSTRARDISPLAY	
0463    010D    1C3C    	BTFSS var2show, 0		; SALTA LÍNEA SI PRIMER BIT ES 1
0464    010E    2910    	GOTO BITXXX0		; SI PRIMER BIT ES 0
0465    010F    2913    	GOTO BITXXX1		; SI PRIMER BIT ES 1	
0466    0110            	
0467    0110            ; PRIMER BIT ES 0
0468    0110            BITXXX0
0469    0110    1CBC    	BTFSS var2show, 1	; SALTA LÍNEA SI SEGUNDO BIT ES 1
0470    0111    2916    	GOTO BITXX00		; 00
0471    0112    2919    	GOTO BITXX10		; 10
0472    0113            ; PRIMER BIT ES 1
0473    0113            BITXXX1
0474    0113    1CBC    	BTFSS var2show, 1	; SALTA SI SEGUNDO BIT ES 1
0475    0114    291C    	GOTO BITXX01		; 01
0476    0115    291F    	GOTO BITXX11		; 11
0477    0116            ;00
0478    0116            BITXX00
0479    0116    1D3C    	BTFSS var2show, 2	; SALTA LÍNEA SI TERCER BIT ES 1
0480    0117    2922    	GOTO BITX000		; 000
0481    0118    2934    	GOTO BITX100		; 100		-> 4	0110011
0482    0119            ;10
0483    0119            BITXX10
0484    0119    1D3C    	BTFSS var2show, 2	; SALTA LÍNEA SI TERCER BIT ES 1
0485    011A    292E    	GOTO BITX010		; 010		-> 2	1101101
0486    011B    293C    	GOTO BITX110		; 110		-> 6	1011111
0487    011C            	
0488    011C            ;01
0489    011C            BITXX01
0490    011C    1D3C    	BTFSS var2show, 2	; SALTA LÍNEA SI TERCER BIT ES 1
0491    011D    2925    	GOTO BITX001		; 001		
0492    011E    2938    	GOTO BITX101		; 101		-> 5	1011011
0493    011F            	
0494    011F            ;11
0495    011F            BITXX11
0496    011F    1D3C    	BTFSS var2show, 2	; SALTA LÍNEA SI TERCER BIT ES 1
0497    0120    2931    	GOTO BITX011		; 011		-> 3	1111001
0498    0121    293F    	GOTO BITX111		; 111		-> 7	1110000
0499    0122            		
0500    0122            ;000
0501    0122            BITX000
0502    0122    1DBC    	BTFSS	var2show, 3	; SALTA LÍNEA SI CUARTO BIT ES 1
0503    0123    2928    	GOTO BIT0000	; 0000		-> 0		1111110
0504    0124    2943    	GOTO BIT1000	; 1000		-> 8		1111111
0505    0125            	
0506    0125            ;001
0507    0125            BITX001
0508    0125    1DBC    	BTFSS var2show, 3	; SALTA LÍNEA SI CUARTO BIT ES 1
0509    0126    292B    	GOTO BIT0001	; 0001		-> 1		0110000
0510    0127    2947    	GOTO BIT1001	; 1001		-> 9		0001100
0511    0128            	
0512    0128            	
0513    0128            ; #0
0514    0128            BIT0000
0515    0128    3081    	MOVLW	B'10000001' ; EN W SE ENCUENTRA 1111110
0516    0129    00A1    	MOVWF	DATO		; DE W A F LE MOVEMOS F
0517    012A    294A    	GOTO DISPLAY
0518    012B            	
0519    012B            ; #1
0520    012B            BIT0001
0521    012B    30E7    	MOVLW	B'11100111' ; EN W SE ENCUENTRA 0110000
0522    012C    00A1    	MOVWF	DATO		; DE W A F LE MOVEMOS F
0523    012D    294A    	GOTO DISPLAY
0524    012E            	
0525    012E            ; #2
0526    012E            BITX010
0527    012E    3049    	MOVLW	B'01001001' ; EN W SE ENCUENTRA 1101101
0528    012F    00A1    	MOVWF	DATO		; DE W A F LE MOVEMOS F
0529    0130    294A    	GOTO DISPLAY
0530    0131            	
0531    0131            ; #3
0532    0131            BITX011
0533    0131    3043    	MOVLW	B'01000011'
0534    0132    00A1    	MOVWF	DATO		; DE W A F LE MOVEMOS F
0535    0133    294A    	GOTO DISPLAY
0536    0134            	
0537    0134            ; #4
0538    0134            BITX100
0539    0134    3027    	MOVLW	B'00100111'
0540    0135    00A1    	MOVWF	DATO		; DE W A F LE MOVEMOS F
0541    0136    294A    	GOTO DISPLAY
0542    0137    0008    	RETURN
0543    0138            ; #5
0544    0138            BITX101
0545    0138    3013    	MOVLW	B'00010011'
0546    0139    00A1    	MOVWF	DATO		; DE W A F LE MOVEMOS F
0547    013A    294A    	GOTO DISPLAY
0548    013B    0008    	RETURN
0549    013C            ; #6
0550    013C            BITX110
0551    013C    3011    	MOVLW	B'00010001'
0552    013D    00A1    	MOVWF	DATO		; DE W A F LE MOVEMOS F
0553    013E    294A    	GOTO DISPLAY
0554    013F            	
0555    013F            ; #7
0556    013F            BITX111
0557    013F    30C7    	MOVLW	B'11000111'
0558    0140    00A1    	MOVWF	DATO		; DE W A F LE MOVEMOS F
0559    0141    294A    	GOTO DISPLAY
0560    0142    0008    	RETURN
0561    0143            ; #8
0562    0143            BIT1000
0563    0143    3001    	MOVLW	B'00000001' ; EN W SE ENCUENTRA 1111111
0564    0144    00A1    	MOVWF	DATO		; DE W A F LE MOVEMOS F
0565    0145    294A    	GOTO DISPLAY
0566    0146    0008    	RETURN
0567    0147            ; #9
0568    0147            BIT1001
0569    0147    3003    	MOVLW	B'00000011' ; EN W SE ENCUENTRA 0001100
0570    0148    00A1    	MOVWF	DATO		; DE W A F LE MOVEMOS F
0571    0149    294A    	GOTO DISPLAY
0572    014A            	
0573    014A            
0574    014A            DISPLAY
0575    014A    0821    	MOVF	DATO, W
0576    014B    0087    	MOVWF	PORTC	
0577    014C    0008    	RETURN
0578    014D            ;;;;;;; FINALIZA MOSTRAR DISPLAY ;;;;;;;;;
0579    014D            ;;;;;;; INICIA METODO PARA CATEGORIZAR;;;;
0580    014D            GetCategoria
0581    014D    3009    	movlw	d'9'
0582    014E    00BA    	movwf	categoria
0583    014F            
0584    014F    30D2    	movlw	d'210'
0585    0150    023B    	subwf	luz512, 0
0586    0151    1803    	BTFSc	STATUS, C
0587    0152    0008    	RETURN	
0588    0153    03BA    	decf	categoria,1
0589    0154    30C2    	movlw	d'194'
0590    0155    023B    	subwf	luz512, 0
0591    0156    1803    	BTFSC STATUS, C
0592    0157    0008    	return
0593    0158    03BA    	decf	categoria,1
0594    0159    30AE    	movlw	d'174'
0595    015A    023B    	subwf	luz512, 0
0596    015B    1803    	BTFSC STATUS, C
0597    015C    0008    	return
0598    015D    03BA    	decf	categoria,1
0599    015E    309E    	movlw	d'158'
0600    015F    023B    	subwf	luz512, 0
0601    0160    1803    	BTFSC STATUS, C
0602    0161    0008    	return
0603    0162    03BA    	decf	categoria,1
0604    0163    308A    	movlw	d'138'
0605    0164    023B    	subwf	luz512, 0
0606    0165    1803    	BTFSC STATUS, C
0607    0166    0008    	return
0608    0167    03BA    	decf	categoria,1
0609    0168    3075    	movlw	d'117'
0610    0169    023B    	subwf	luz512, 0
0611    016A    1803    	BTFSC STATUS, C
0612    016B    0008    	return
0613    016C    03BA    	decf	categoria,1
0614    016D    3052    	movlw	d'82'
0615    016E    023B    	subwf	luz512, 0
0616    016F    1803    	BTFSC STATUS, C
0617    0170    0008    	return
0618    0171    03BA    	decf	categoria,1
0619    0172    3033    	movlw	d'51'
0620    0173    023B    	subwf	luz512, 0
0621    0174    1803    	BTFSC STATUS, C
0622    0175    0008    	return
0623    0176    03BA    	decf	categoria,1
0624    0177    301C    	movlw	d'28'
0625    0178    023B    	subwf	luz512, 0
0626    0179    1803    	BTFSC STATUS, C
0627    017A    0008    	return
0628    017B    03BA    	decf	categoria, 1
0629    017C    0008    	return
0630    017D            ;;;;;;;;;; FINALIZA METODO PARA CATEGORIZAR ;;;;;;;;;;
0631    017D            ;;;;;;;;;; FINALIZA LECTURA DE FOTORESISTOR ;;;;;;;;;;
0632    017D            
0633    017D            AsignarLuz512
0634    017D            
0635    017D            _bucle
0636    017D            	;btfss INTCON,T0IF
0637    017D            	;goto _bucle ;Esperar que el timer0 desborde
0638    017D            	; SE DEBE DE COLOCAR UN DELAY PARA QUE ESPERE LA CONVERSION
0639    017D    1503    	BSF  STATUS,Z
0640    017E    2190    	CALL _PRESPERA
0641    017F    110B    	bcf INTCON,T0IF ;Limpiar el indicador de desborde
0642    0180    151F    	bsf ADCON0,GO ;Comenzar conversion A/D
0643    0181            _espera
0644    0181    191F    	btfsc ADCON0,GO ;ADCON0 es 0? (la conversion esta completa?)
0645    0182    2981    	goto _espera ;No, ir _espera
0646    0183    081E    	movf ADRESH,W ;Si, W=ADRESH
0647    0184            	; 1Eh ADRESH A/D Result Register High Byte
0648    0184            	; 9Eh ADRESL A/D Result Register Low Byte 
0649    0184    00BD    	movwf ADC ;ADC=W
0650    0185            	;rrf ADC,F ;ADC /4
0651    0185            	;rrf ADC,F
0652    0185            	;bcf ADC,7
0653    0185            	;bcf ADC,6
0654    0185    083D    	movfw ADC ;W = ADC
0655    0186    00BB    	movwf luz512 ;luz512 = W
0656    0187    214D    	call getCategoria
0657    0188    0008    	return
0658    0189    3020    	movlw D'32' ;Comparamos el valor del ADC para saber si es menor que 128
0659    018A    023D    	subwf ADC,W
0660    018B            	;btfss STATUS,C ;Es mayor a 128?
0661    018B    298E    	goto _desactivar ;No, desactivar RB7
0662    018C    1787    	bsf PORTC,7 ;Si, RB7 = 1 logico
0663    018D    297D    	goto _bucle ;Ir bucle
0664    018E            _desactivar
0665    018E    13BB    	bcf luz512,7 ;RB7 = 0 logico
0666    018F    297D    	goto _bucle ;Ir bucle
0667    0190            	
0668    0190            _PRESPERA
0669    0190    30FF    	MOVLW 0XFF
0670    0191    00BF    	MOVWF CON
0671    0192    00C0    	MOVWF CON2
0672    0193    00C1    	MOVWF CON3	
0673    0194    2196    	CALL ESPE
0674    0195    0008    	RETURN	
0675    0196            	
0676    0196            ESPE
0677    0196    0BBF    	DECFSZ	CON,0X01
0678    0197    2996    	GOTO	ESPE
0679    0198    219A    	CALL	ESPE2
0680    0199    0008    	RETURN
0681    019A            ESPE2
0682    019A    0BC0    	DECFSZ	CON2,0X01
0683    019B    299A    	GOTO	ESPE2
0684    019C    219E    	CALL	ESPE3
0685    019D    0008    	RETURN
0686    019E            ESPE3
0687    019E    0BC1    	DECFSZ	CON3,0X01
0688    019F    299E    	GOTO	ESPE3
0689    01A0    0008    	RETURN		
0690    01A1            ;;;;;;;;;; FINALIZA LECTURA DE FOTORESISTOR ;;;;;;;;;;
0691    01A1            ;;;;;;;;;; COMPARACION PROPIA DE LUZ 	    ;;;;;;;;;;
0692    01A1            ASSMAXMIN_P	
0693    01A1    217D    	CALL AsignarLuz512			;quitar comentario
0694    01A2    214D    	CALL getCategoria
0695    01A3    083A    	movf categoria, w
0696    01A4    00BC    	movwf	var2show
0697    01A5    210D    	call mostrardisplay
0698    01A6            
0699    01A6            
0700    01A6    083A    	MOVF	categoria,W
0701    01A7    0243    	SUBWF	luzmin,W	
0702    01A8    1803    	BTFSC	STATUS,C
0703    01A9    21B6    	CALL	EntradaMenor
0704    01AA            
0705    01AA    083A    	MOVF	categoria,W
0706    01AB    0242    	SUBWF	luzmax,W
0707    01AC    1C03    	BTFSS	STATUS,C
0708    01AD    21AF    	CALL 	EntradaMayor
0709    01AE    0008    	return
0710    01AF            EntradaMayor
0711    01AF    083A    	MOVF	categoria,W
0712    01B0    00C2    	MOVWF	luzmax
0713    01B1    082B    	movf	x,	w
0714    01B2    00AD    	movwf	x_f
0715    01B3    082C    	movf	y,	w
0716    01B4    00AE    	movwf	y_f
0717    01B5    0008    	RETURN
0718    01B6            
0719    01B6            EntradaMenor
0720    01B6    083A    	MOVF	categoria,W
0721    01B7    00C3    	MOVWF	luzmin
0722    01B8    0008    	RETURN
0723    01B9            ;;;;;;;;; COMPARACION AJENA DE LUZ	     ;;;;;;;;;;
---------------------------------------------
Number of errors = 0
